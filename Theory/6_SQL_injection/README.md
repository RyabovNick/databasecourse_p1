# SQL injection

SQL инъекция – один из самый распространённых способов взлома ПО, работающего с БД, с sql запросами.

Возможные sql инъекции:

1. Сделать условие where всегда истинным.
2. Присоединить к запросу другой запрос через UNION
3. Комментирование части запроса
4. Выполнение нескольких запросов

5. Допустим, у нас есть запрос

```sql
SELECT *
FROM students
WHERE n_zach = :value;
```

Где :value – входной параметр и предполагается, что это будет просто цифра. Например 1, 2, 3 и т.д.. И этот запрос нам будет возвращать всю информацию о конкретном студенте.

На если вместо числа задать :value как 1 or 1 = 1, то запрос приобретёт следующий вид:

```sql
SELECT *
FROM students
WHERE n_zach = 1
  OR 1 = 1;
```

Очевидно, что данный запрос вернёт не одну строку, а всё содержимое таблицы.

2. Допустим, есть запрос:

```sql
SELECT n_zach,
       name,
       surname,
       n_group
FROM students
WHERE n_zach = :__value;
```

Предполагается, что :value будет принимать число и выводиться номер зачётки, имя, фамилия и номер группа студента. Но можно вместо этого передать следующие данные:

`_-1_`

`_UNION_`

```sql
SELECT 1,
       name,
       '1',
       1
FROM hobby;
```

В итоге запрос будет выглядеть так:

```sql
SELECT n_zach,
       name,
       surname,
       n_group
FROM students
WHERE n_zach = -1
UNION
SELECT 1,
       name,
       '1',
       1
FROM hobby;
```

Студента с номером зачётки -1 не существует, поэтому первый запрос ничего не вернёт, а вот второй вернёт названия хобби.

В Select добавлены 1, '1' т.к объединять можно только запросы, возвращающие одинаковое количество атрибутов, а также эти атрибуты должны быть одинакового типа

3. Если бы предыдущий запрос выглядел вот таким образом:

```sql
SELECT n_zach,
       name,
       surname,
       n_group
FROM students
WHERE n_zach = :value
  AND name LIKE '%';
```

То предыдущий запрос уже бы не сработал, но можно после запроса добавить комментарий, например /\*, который закомментирует весь следующий код.

4. Допустим, для запроса

```sql
SELECT n_zach,
       name,
       surname,
       n_group
FROM students where_ _n___zach = :__value;
```

добавляется такая часть

_1;_ _DROP_ _TABLE_ _students;_

В итоге на экран будет выведена информация о студенте с номером зачётки 1, а потом таблица студенты будет удалена.

Защита от sql инъекций заключается в том, чтобы проверять все входящие параметры. Сейчас почти везде реализованы функции для этого, например php: mysqli_real_escape_string – для проверки.

Необходимо всех использовать параметры, например в ASP.NET:

```c#
n_zach = getRequestString("n_zach");
query = "SELECT * FROM students WHERE n_zach = @0";
db.Execute(query, zach);
@0 – параметр.
```
